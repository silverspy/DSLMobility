<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <title><img src="http://54.36.98.109/comute.png">title</title>
</head>
<link rel="stylesheet" type="text/css" href="../style.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
<script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
<script src="../Leaflet.encoded-master/Polyline.encoded.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<body>
    <div class="wrapper">
        <!-- Begin side bar -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3> <img src="http://54.36.98.109/comute.png" width="30" height="30" class="d-inline-block align-top" alt=""> title</h3>
            </div>
            <ul class="list-unstyled components">
                <li>
                    <button style="color: white; width: 100%; text-align: left;" type="button" id="introductionRDV" class="btn"><i class="fas fa-home"></i> home</button>
                </li>
                <li>
                    <button style="color: white; width: 100%; text-align: left;" type="button" id="createRDV" class="btn"><i class="far fa-calendar"></i> Create a RDV</button>
                </li>
                <li>
                    <button type="button" style="color: white; width: 100%; text-align: left;" id="listRDV" class="btn"> <i class="fas fa-list"></i> List all RDV</button>
                </li>

                <li>
                    <button type="button" style="color: white; width: 100%; text-align: left;" id="joinRDV" class="btn"> <i class="fas fa-list"></i> join RDV</button>
                </li>
            </ul>
        </nav>
        <!-- end sidebar -->
        <div id="content" style="width: 100vw">
            <nav>
                <div>
                    <button type="button" id="sidebarCollapse" class="btn btn-info">
                        <i class="fas fa-align-justify"></i>
                    </button>
                </div>
            </nav>
            <div class="row">
                <div class="col-lg-12" style=" text-align: center;">
                    <h1> <img src="http://54.36.98.109/comute.png" width="30" height="30" class="d-inline-block align-top" alt=""> title</h1>
                </div>
                <div id="receptacle" class="col-lg-12">
                </div>
            </div>
        </div>
    </div>
    <div id="introduction" style="margin-top: 1%;margin-left: 3%;margin-bottom: 1%">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h2>Introduction</h2>
            </div>
            <div class="panel-body ">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <img class="card-img-top" src="http://54.36.98.109/RDV/rdv.png" alt="Card image cap" style="height: 35vh;">
                            <div class="card-body">
                                <button class="btn btn-primary" id="goto_create_rdv">Creer un rdv</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card">
                            <img class="card-img-top" src="http://54.36.98.109/RDV/list.png" alt="Card image cap" style="height: 35vh;">
                            <div class="card-body">
                                <button class="btn btn-primary" id="goto_list_rdv">voir la liste des rdv</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="card">
                            <img class="card-img-top" src="http://54.36.98.109/RDV/join.png" alt="Card image cap" style="height: 35vh;">
                            <div class="card-body">
                                <button class="btn btn-primary" id="goto_join_rdv">Rejoindre un rdv</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                </div>
            </div>
        </div>
    </div>
    <!-- list panel -->
    <div id="list" style="margin-top: 1%;margin-left: 3%;margin-bottom: 1%">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h2>Liste des RDV</h2>
            </div>
            <div class="panel-body">
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Id</th>
                            <th scope="col">Adresse</th>
                            <th scope="col">Date</th>
                            <th scope="col">nb people</th>
                        </tr>
                    </thead>
                    <tbody id="tableList">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <!-- end list panel -->
    <!--  create panel -->
    <div id="create" style="margin-top: 1%;margin-left: 3%;margin-bottom: 1%">
        <div class="row">
            <div class="col-lg-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2>Create a meeting</h2>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="adressUser">User address</label>
                            <input type="text" class="form-control" id="adressUser" aria-describedby="emailHelp" placeholder="Enter your adress">
                        </div>
                        <div class="form-group">
                            <label for="adressRDV">RDV address</label>
                            <input type="text" class="form-control" id="adressRDV" aria-describedby="emailHelp" placeholder="Enter RDV adress">
                        </div>
                        <div class="form-group">
                            <label for="nameUser">User name</label>
                            <input type="text" class="form-control" id="nameUser" aria-describedby="emailHelp" placeholder="Enter your name">
                        </div>
                        <div class="form-group">
                            <label for="dateRDV"> Date du RDV</label>
                            <input type="date" id="dateRDV" name="trip-start" value="2018-07-22" min="2019-01-01" max="2028-12-31">
                        </div>
                         <div class="form-group">
                            <label for="timeRDV"> Heure du RDV</label>
                           <input type="number" id="hourRDV" min="8" max="17" required>  <label for="timeRDV">h 00</label>
                        </div>
                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" name="type" type="radio" value="" id="tisseo">
                                <label class="form-check-label" for="tisseo">
                                    Tisseo
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" name="type" type="radio" value="" id="google">
                                <label class="form-check-label" for="google">
                                    Google
                                </label>
                            </div>
                        </div>
                        <button id="valid_Creation" class="btn btn-primary">Submit</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-6" id="consigneTrajet">
            </div>
        </div>
    </div>
    <!-- end panel create -->
    <!-- join panel -->
    <div id="join" style="margin-top: 1%;margin-left: 3%;margin-bottom: 1%">
        <div class="row">
            <div class="col-lg-7 col-xs-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h2>Join a meeting</h2>
                    </div>
                    <div class="panel-body">
                        <div class="form-group">
                            <label for="adressUserJoin">User address</label>
                            <input type="text" class="form-control" id="adressUserJoin" aria-describedby="adressHelp" placeholder="Enter your adress">
                        </div>
                        <div class="form-group">
                            <label for="nameUserJoin">User name</label>
                            <input type="text" class="form-control" id="nameUserJoin" aria-describedby="emailHelp" placeholder="Enter your name">
                        </div>
                       <div class="form-group" id="select_appending">
                           
                        </div>
                        <button id="valid_Join" class="btn btn-primary">Join</button>
                    </div>
                </div>
            </div>
            <div class="col-lg-5 col-xs-12">
                <div id="consigneTrajet2">
                </div>
            </div>
        </div>
    </div>
    <footer id="sticky-footer" class="py-4 bg-dark text-white-50">
        <div class="container text-center">
            <div class="row">
                <div class="col-md-6">
                    footer_description
                </div>
                <div class="col-md-6">
                    <div class="row">
                        <div class="col-lg-6">
                            <label> <i class="fas fa-phone-square"></i> Téléphone : phone_to_replace </label>
                        </div>
                        <div class="col-lg-6">
                            <label> <i class="fas fa-envelope-square"></i> Mail : mail_to_replace </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- Write your comments here -->
</body>
<script type="text/javascript">
$(document).ready(function() {
    //url du serveur
    var url = "http://54.36.98.109:8080/"
    var typeBody = "introduction"
    var ArrayTipe = ["introduction", "list", "create", "join"];
    for (type in ArrayTipe) {
        if (ArrayTipe[type] != typeBody) {
            $("#" + ArrayTipe[type]).hide();
        }
    }

    $("#dateRDV").val(new Date().toJSON().slice(0,19));
    
   function fill_select(){

       var div = $("#select_appending");
       $(div).empty();
        $.ajax({
           type: "POST",
           url: url + "getHoraireRDV",
           data: {},
           success: function(data, textStatus, jqXHR) {
               var str = ""
               var dispo = data.horaire;
               console.log(dispo);
               console.log(data);
               if(dispo.length > 0)
               {
                   $("#valid_Join").prop("disabled",false);
                   str = "<select id='rdvtoJoin'>";
                   for(var i = 0 ; i< dispo.length; i++)
                   {
                       var rdvDispo = dispo[i];
                       str +="<option value =\'" + rdvDispo + "\'>"+rdvDispo + "</option>";
                   }
                   str += "</select>";
               }
               else
               {
                   alert("aucun rendez vous disponible actuellement/ aucun rendez vous creer");
                   $("#valid_Join").prop("disabled",true);
               }
               $(div).html(str);
              
           },
           error: function(jqXHR, textStatus, errorThrown) {
             alert("error");
           },
       });


   }


    $("#receptacle").append($("#" + typeBody));
    //cache la  side bar menu
    $('#sidebarCollapse').on('click', function() {
        $('#sidebar').toggleClass('active');
    });
    //charge la page de creation du rdv
    $('#createRDV').on('click', function() {
        $("#" + typeBody).appendTo(document.body)
        $("#" + typeBody).hide()
        typeBody = "create";
        $("#" + typeBody).show();
        $("#receptacle").append($("#" + typeBody));
    });
    // charge la page permettant de rejoindre un rdv
    $('#joinRDV').on('click', function() {
        $("#" + typeBody).appendTo(document.body)
        $("#" + typeBody).hide()
        typeBody = "join";
        $("#receptacle").append($("#" + typeBody));
        $("#" + typeBody).show();
        alert("joinRDV")
        fill_select();
    });
    //charge la page d'accueil
    $('#introductionRDV').on('click', function() {
        $("#" + typeBody).appendTo(document.body)
        $("#" + typeBody).hide()
        typeBody = "introduction";
        $("#receptacle").append($("#" + typeBody));
        $("#" + typeBody).show();
        alert("introductionRDV")
    });
    //charge la page listant l'ensemble des rendez vous
    $('#listRDV').on('click', function() {
        $("#" + typeBody).appendTo(document.body)
        $("#" + typeBody).hide()
        typeBody = "list";
        $("#receptacle").append($("#" + typeBody));
        $("#" + typeBody).show();
        alert("listRDV")
        //lance une  requete asynchrone vers le server permmettant de recuperer la liste des rendez vous
        $.ajax({
            type: "POST",
            url: url + "listRDVinPlanning",
            data: {},
            success: function(data, textStatus, jqXHR) {
                var str = ""
                var len = data.meetings.length;
                var listRDV = data.meetings;
                for (var i = 0; i < len; i++) {
                    var index = i + 1;
                    str += "<tr>";
                    str += "<th scope='row'>" + index + "</th>";
                    str += "<td>" + listRDV[i].id + "</td>";
                    str += "<td>" + listRDV[i].adress + "</td>";
                    str += "<td>" + listRDV[i].date + "</td>";
                    str += "<td>" + listRDV[i].nbPeople + "</td>";
                }
                $("#tableList").html(str);
                alert("second success");
            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert("error")
            },
        });
    });
    //function permettant de valider la creation de rendez vous
    $("#valid_Creation").click(function() {
        var obj = {}
        var type = $("#tisseo").prop("checked") == true ? "tisseo" : "google";
        obj.name = $("#nameUser").val();
        obj.adress = $("#adressUser").val();
        obj.adressRDV = $("#adressRDV").val();
        var hourRDV = $("#hourRDV").val();
        hourRDV = "" + hourRDV + ":00";
        obj.dateRDV = "" + $("#dateRDV").val() + "+" + hourRDV; 
        obj.api = type;
        $.ajax({
            type: "POST",
            url: url + "createRDVinPlanning",
            data: obj,
            success: function(data, textStatus, jqXHR) {
                //data - response from serve
                var div = $("#consigneTrajet")
                var str = "<h2>Vos Instructions</h2>"

               if(data.APItype == "tisseo")
                {

                  var data = data.APIresponse;
                  if (data.routePlannerResult.query.maxSolutions > 0) {
                      var journey = data.routePlannerResult.journeys[0].journey;
                      for (var i = 0; i < journey["chunks"].length; i++) {
                          str += "<br>"
                          var index = i + 1;
                          str += "Etape " + index;
                          if (journey.chunks[i].service) {
                              str += "<i class='fas fa-bus'></i>  "
                              str += " " + journey.chunks[i].service.text.text;
                          } else if (journey.chunks[i].street) {
                              str += "<i class='fas fa-walking'></i>  "
                              str += " " + journey.chunks[i].street.text.text;
                          } else if (journey.chunks[i].stop) {
                              str += "<i class='fas fa-hand-paper'></i>  "
                              str += " " + journey.chunks[i].stop.text.text;
                          }
                      }
                      div.html(str);
                  }

                }
                else if(data.APItype == "google")
                {
                  var data = data.APIresponse;
                  if(data.routes.length > 0)
                  {

                    var routes = data.routes[0]["legs"];
                    encoded = data.routes[0].overview_polyline.points;

                    str += "Vous partez de " + routes[0].start_address;

                    var steps = routes[0].steps;

                    for(var i = 0 ; i < steps.length; i++) {

                      str += "<br>";
                      var index = i + 1;
                          str += "Etape " + index;
                      
                      if (steps[i].travel_mode == "WALKING")
                      {
                        for(var j=0; j<steps[i].steps.length; j++)
                        {

                          str += "<i class='fas fa-walking'></i>  ";
                            str += steps[i].steps[j].html_instructions;
                        }
                      }
                      else if(steps[i].travel_mode == "TRANSIT")
                      {

                        str += "<i class='fas fa-subway'></i>   ";
                        str += "Prenez le "+steps[i].transit_details.name+" a destination de " + steps[i].transit_details.headsign + "arretez vous a l'arret "+ steps[i].transit_details.arrival_stop.name + "("+steps[i].transit_details.num_stop+" arrets)";

                      }
                      else
                      {
                        str += "<i class='fas fa-car'></i>";
                        str += steps[i].html_instructions;
                      }



                    }

                  }
                  div.html(str);
                }
                else
                {
                  alert("APItype not supported")
                }


            },
            error: function(jqXHR, textStatus, errorThrown) {
                alert("error");
                console.log(errorThrown)

            },
            dataType: "json"
        });
    })
    //rejoindre un rendez vous
    //cette function effectue un appel a /joinRDV et permet au participant apres qu'il est renseigné son nom et prenom de rejoindre le rdv indiqué
    $("#valid_Join").click(function() {
        var obj = {}
        obj.name = $("#nameUserJoin").val();
        obj.adress = $("#adressUserJoin").val();
        obj.idRDV   = $("#rdvtoJoin").val();
        var type    = $("#jointisseo").prop("checked") == true ? "tisseo" : "google";
        obj.api     = type;
        // appel asynchrone vers le serveur
        $.ajax({

            type: "POST",
            url: url + "joinRDVinPlanning",
            data: obj,
            //en cas de succes de la requete  asynchrone
            success: function(data, textStatus, jqXHR) {
                //data - response from server

                var div = $("#consigneTrajet2")
                var str = "<h2>Vos Instructions</h2>"
                  if(data.APItype == "tisseo")
                {

	                var data = data.APIresponse;
	                if (data.routePlannerResult.query.maxSolutions > 0) {
	                    var journey = data.routePlannerResult.journeys[0].journey;
	                    for (var i = 0; i < journey["chunks"].length; i++) {
	                        str += "<br>"
	                        var index = i + 1;
	                        str += "Etape " + index;
	                        if (journey.chunks[i].service) {
	                            str += "<i class='fas fa-bus'></i>  "
	                            str += " " + journey.chunks[i].service.text.text;
	                        } else if (journey.chunks[i].street) {
	                            str += "<i class='fas fa-walking'></i>  "
	                            str += " " + journey.chunks[i].street.text.text;
	                        } else if (journey.chunks[i].stop) {
	                            str += "<i class='fas fa-hand-paper'></i>  "
	                            str += " " + journey.chunks[i].stop.text.text;
	                        }
	                    }
	                    div.html(str);
	                }

                }
                else if(data.APItype == "google")
                {
                	var data = data.APIresponse;
                	if(data.routes.length > 0)
                	{

                		var routes = data.routes[0]["legs"];
                		encoded = data.routes[0].overview_polyline.points;

                		str += "Vous partez de " + routes[0].start_address;

               			var steps = routes[0].steps;

                		for(var i = 0 ; i < steps.length; i++) {

                			str += "<br>";
                			var index = i + 1;
	                        str += "Etape " + index;
                			
                			if (steps[i].travel_mode == "WALKING")
                			{
                				for(var j=0; j<steps[i].steps.length; j++)
                				{

                					str += "<i class='fas fa-walking'></i>  ";
                				  	str += steps[i].steps[j].html_instructions;
                				}
                			}
                			else if(steps[i].travel_mode == "TRANSIT")
                			{

                				str += "<i class='fas fa-subway'></i>   ";
                				str += "Prenez le "+steps[i].transit_details.name+" a destination de " + steps[i].transit_details.headsign + "arretez vous a l'arret "+ steps[i].transit_details.arrival_stop.name + "("+steps[i].transit_details.num_stop+" arrets)";

                			}
                            else
                            {
                              str += "<i class='fas fa-car'></i>";
                              str += steps[i].html_instructions;
                            }



                		}

                	}
                	div.html(str);
                }
                else
                {
                	alert("APItype not supported")
                }

            },
            //en cas d'erreur de la requete asynchrone
            error: function(jqXHR, textStatus, errorThrown) {
                alert("Vous ne pouvez pas joindre ce rendez vous");
                console.log(errorThrown)
            },
            dataType: "json"
        });
    })

});
</script>

</html>